#!/bin/bash

touchpad="`tpctl status`"

if [[ $1 = --dpms ]]; then
  dpms=on
fi

revert() {
  if [[ $dpms = on ]]; then
    xset dpms 0 0 0
  fi
  nohup dunst &
  (( ! $touchpad )) && tpctl disable
  xautolock -enable
}

trap revert HUP INT TERM
killall dunst
tpctl enable
if [[ $dpms = on ]]; then
  xset +dpms dpms 5 5 5
  xset dpms force off
fi
xautolock -disable
LC_ALL=en_US.UTF-8 i3lock -euni ~/.local/share/i3/lockscreen.png
revert
