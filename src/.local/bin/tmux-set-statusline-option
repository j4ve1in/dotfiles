#!/bin/zsh

main() {
  set-statusline.left
  set-statusline.right
  set-statusline.window-format
  set-statusline.window-current-format
}

set-statusline.left() {
  typeset STATUS_L
  # Session
  STATUS_L='#[fg=colour231,bg=colour17,bold]#{?client_prefix,#[reverse],} #S '
  # separator
  if is-x && is-patched-font;then
    STATUS_L+='#[fg=colour17,bg=default]'
    STATUS_L+='#{?client_prefix,#[fg=colour233]#[bg=colour231],}\ue0b0'
  fi
  tmux set -g status-left "`echo -e $STATUS_L`"
}

set-statusline.right() {
  typeset STATUS_R
  if is-x && is-patched-font;then
    STATUS_R+='#[fg=colour21,bg=default]\ue0b2'
  fi
  STATUS_R+='#[fg=colour231,bg=colour21] #T '
  if is-x && is-patched-font;then
    STATUS_R+='#[fg=colour17,bg=colour21]\ue0b2'
  fi
  STATUS_R+='#[fg=colour231,bg=colour17] #P '
  tmux set -g status-right "`echo -e $STATUS_R`"
}

set-statusline.window-format() {
  typeset STATUS_WF
  # window index and flag
  STATUS_WF='#[fg=colour244,bg=default]  #I#F '
  # separator
  {is-x && is-patched-font} && STATUS_WF+='#[fg=colour240,bg=default]\ue0b1' || STATUS_WF+=':'
  # window name
  STATUS_WF+=' #[fg=colour33]#W  '
  tmux setw -g window-status-format "`echo -e $STATUS_WF`"
}

set-statusline.window-current-format() {
  typeset STATUS_WCF
  # separator
  {is-x && is-patched-font} && STATUS_WCF+='#[fg=black,bg=colour21]\ue0b0'
  # Current window index and flag
  STATUS_WCF+='#[fg=colour231,bg=colour21] #I#F '
  # separator
  {is-x && is-patched-font} && STATUS_WCF+='\ue0b1' || STATUS_WCF+=':'
  # Current window name
  STATUS_WCF+=' #[fg=colour231,bg=colour21]#W '
  # separator
  {is-x && is-patched-font} && STATUS_WCF+='#[fg=colour21,bg=black]\ue0b0'
  tmux setw -g window-status-current-format "`echo -e $STATUS_WCF`"
}

is-x() { [[ $DISPLAY ]] && return 0 || return 1; }

is-patched-font() {
  if [[ `fc-list | grep 'Inconsolata Nerd Font'` ]]; then
    return 0
  else
    return 1
  fi
}

main
