private base_path="$(git rev-parse --show-cdup | sed 's%/%\\/%g')"
private -a file=($(git status --porcelain | sed "s/^\(..\) /\1\t${base_path}/" | grep "^.[MD?]" | $SELECTOR | awk '{print $2}'))
[[ -z $file ]] && return 1
for file in $file; do
  [[ ! -f $file ]] && return 1
done
BUFFER="git add -- $file"
CURSOR=$#BUFFER
zle accept-line
zle -R -c

# vim: ft=zsh sw=2 ts=2 et
