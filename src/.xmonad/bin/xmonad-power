#!/bin/zsh

if [ "$1" = 'select' ]; then
  [ -f ~/.config/dmenurc ] && . ~/.config/dmenurc || DMENU=''

  RET=$(echo -e "halt\nreboot\nlock\nlogout" | dmenu -p 'Power' ${=DMENU})

  case $RET in
    halt) halt -p ;;
    reboot) reboot ;;
    lock)
      pidfile=/tmp/unclutter.pid
      if [[ ! -f $pidfile ]]; then
        light-locker-command -l
      else
        killall unclutter
        rm "$pidfile"
        light-locker-command -l
        unclutter -idle 1 -root -grab &
        echo $! > "$pidfile"
      fi
      ;;
    logout) xdotool key "super+shift+q" ;;
    *) ;;
  esac
elif [ "$1" = 'restart' ]; then
  xmonad --recompile && xmonad --restart
  notify-send "xmonad" "Compiled and Restarted xmonad"
fi
