#!/bin/zsh

. dbase && . dcore

# Check dotfiles version
cprint 'Check for updates' $UNDERLINE
git -C $DROOT fetch >/dev/null 2>&1
LOCAL=$(git -C $DROOT rev-parse --short HEAD)
REMOTE=$(git -C $DROOT rev-parse --short origin/HEAD)
cprintf ' Dotfiles version: ' "$COLOR_75_B"
if [ "$LOCAL" = "$REMOTE" ]; then
  echo -e 'up to date\n'
else
  echo -e 'local out of date\n'

  # Pull remote repository
  cprint 'Update dotfiles' $UNDERLINE
  lprintf ' Pull remote repository' "git -C $DROOT pull origin master"
  printf "  $LOCAL"
  cprintf ' -> ' $COLOR_93_B
  print "$REMOTE"
  echo

  # Backup and Deploy
  dbackup && ddeploy
fi
